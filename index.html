<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HansGenSub — Auto Subtitle Generator</title>
<style>
  body{font-family:Inter,system-ui,Arial;background:#f6f8fb;color:#0b1726;margin:0;padding:24px;display:flex;align-items:center;justify-content:center;min-height:100vh}
  .card{width:100%;max-width:760px;background:#fff;border-radius:12px;padding:20px;box-shadow:0 8px 30px rgba(16,24,40,0.06)}
  h1{margin:0 0 8px;font-size:20px;color:#06203a}
  p.lead{margin:0 0 16px;color:#556b82}
  input[type=file],select{padding:12px;border-radius:8px;border:1px solid:#d9e3f2;background:#fff;color:#081124;width:100%}
  button{padding:12px;border-radius:8px;border:none;background:#0b76ff;color:#fff;cursor:pointer;font-size:16px;width:100%;margin-top:12px}
  button:disabled{opacity:0.6}
  #status{margin-top:12px;color:#556b82;font-size:14px}
  .progress{height:10px;background:#eef3ff;border-radius:6px;overflow:hidden;margin-top:8px;display:none}
  .progress>i{display:block;height:100%;width:0;background:linear-gradient(90deg,#7cc1ff,#0b76ff)}
  #resultBox{display:none;margin-top:16px}
</style>
</head>
<body>
  <div class="card">
    <h1>HansGenSub — Auto Subtitle Generator</h1>
    <p class="lead">Upload video → pilih bahasa → hasil subtitle .srt otomatis</p>

    <input id="fileInput" type="file" accept="video/mp4,video/mkv,video/webm" />

    <!-- Pilih bahasa subtitle awal -->
    <label>Pilih bahasa video</label>
    <select id="language">
      <option value="auto">Auto Detect</option>
      <option value="id">Bahasa Indonesia</option>
      <option value="en">English</option>
      <option value="zh">中文 (Mandarin)</option>
      <option value="ja">日本語</option>
      <option value="ko">한국어</option>
      <option value="es">Español</option>
      <option value="fr">Français</option>
    </select>

    <!-- Translate subtitle ke bahasa lain -->
    <label>Terjemahkan subtitle ke</label>
    <select id="translate">
      <option value="none">Tidak usah translate</option>
      <option value="id">Bahasa Indonesia</option>
      <option value="en">English</option>
    </select>

    <button id="generateBtn" disabled>Generate Subtitle</button>

    <div id="status">Menunggu file...</div>
    <div class="progress" id="progressBar"><i></i></div>

    <div id="resultBox">
      ✅ Selesai — <a id="downloadLink" href="#" download>Download Subtitle</a>
    </div>
  </div>

<script>
const fileInput = document.getElementById('fileInput');
const language = document.getElementById('language');
const translate = document.getElementById('translate');
const generateBtn = document.getElementById('generateBtn');
const status = document.getElementById('status');
const progress = document.getElementById('progressBar');
const progFill = progress.querySelector('i');
const resultBox = document.getElementById('resultBox');
const downloadLink = document.getElementById('downloadLink');
let currentFile = null;

fileInput.addEventListener('change', ()=>{
  currentFile = fileInput.files[0];
  if(currentFile){ status.textContent = `File terpilih: ${currentFile.name}`; generateBtn.disabled = false; }
});

// Kirim ke backend (Vercel serverless api)
generateBtn.addEventListener('click', async ()=>{
  if(!currentFile) return alert('Pilih file video dulu');

  generateBtn.disabled=true;
  resultBox.style.display='none';
  progress.style.display='block'; 
  progFill.style.width='10%';
  status.textContent='Mengirim file...';

  const fd = new FormData();
  fd.append('file', currentFile);
  fd.append('language', language.value);
  fd.append('translate', translate.value);

  try{
    const res = await fetch('/api/transcribe', { method:'POST', body: fd });
    const data = await res.json();

    if(!data.srt_url) throw new Error('Tidak ada output');

    progFill.style.width='100%';
    status.textContent='✅ Selesai!';

    downloadLink.href=data.srt_url;
    resultBox.style.display='block';
    setTimeout(()=> downloadLink.click(), 400);
  }
  catch(e){ status.textContent='❌ Error: '+e.message; progFill.style.width='0%'; }
  finally{ generateBtn.disabled=false; }
});
</script>
</body>
</html>
